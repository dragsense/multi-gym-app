listen 1935;
max_connections 1000;
daemon off;
srs_log_tank console;

# RTC Server configuration (global level)
# WebRTC over TCP - UDP often blocked in Docker/WSL2; TCP is more reliable
rtc_server {
    enabled         on;
    listen          8000;
    candidate       $CANDIDATE;
    merge_nalus     off;
    # Disable auto-detect - use CANDIDATE env so browser (on host) can reach WebRTC
    use_auto_detect_network_ip off;
    api_as_candidates on;
    # WebRTC over TCP - use when UDP fails (Docker, WSL2, firewalls)
    tcp {
        enabled     on;
        listen      8000;
    }
    protocol        all;
}

# HTTP API for SRS (RTC API)
http_api {
    enabled on;
    listen 1985;
    crossdomain on;
}

# HTTP Server for FLV/HLS
http_server {
    enabled on;
    listen 8080;
    dir ./objs/nginx/html;
}

vhost __defaultVhost__ {
    # HTTP remux for FLV playback
    http_remux {
        enabled on;
        mount [vhost]/[app]/[stream].flv;
    }

    # HLS configuration
    hls {
        enabled on;
        hls_fragment 2;
        hls_window 6;
        hls_path ./objs/nginx/html;
        hls_m3u8_file [app]/[stream].m3u8;
        hls_ts_file [app]/[stream]-[seq].ts;
    }

    # RTC (WebRTC) configuration
    rtc {
        enabled on;
        rtmp_to_rtc on;
        nack on;
        twcc on;
        bframe discard;
    }
}